# Pypandoc Converter - 更新日志

## [2.0.0] - 2025-01-15

### 主要更新

#### 🎯 复杂表格问题解决方案
- **新增两步转换法**：DOCX → HTML → MD，专门解决表格列偏移（串列）问题
- **HTML 预处理工具**：自动检测和修复 HTML 表格中的常见问题
- **GFM 格式支持**：优先使用 GitHub Flavored Markdown 以获得最佳表格支持

#### 🔧 新增功能

**convert_to_markdown.py 增强**:
- 新增 `--format` 选项，支持指定输出格式（markdown, gfm, html 等）
- 新增 `--two-step` 选项，一键执行两步转换法
- 新增 `--step1` 和 `--step2` 选项，支持分步手动转换
- 新增 `convert_with_html_intermediate()` 函数，完整的两步转换 API
- 支持自定义格式类型和额外参数

**新增 preprocess_html.py 脚本**:
- 自动删除零宽度空列（width: 0%）
- 自动删除空的 `<colgroup>` 标签
- HTML 表格结构验证功能
- 合并单元格（colspan/rowspan）检测
- 命令行接口支持独立使用
- Python API 支持程序化处理

**批量转换增强**:
- 支持两步转换法的批量处理
- 支持自定义输出格式
- 改进的错误处理和进度显示

#### 📚 新增文档

**references/table_conversion_guide.md**:
- 完整的表格转换问题分析
- 两步转换法详细步骤
- 根本原因和解决方案说明
- 实际案例研究
- 最佳实践和故障排除

**examples/table_conversion_example.py**:
- 7 个完整的使用示例
- 涵盖所有主要功能
- 可直接运行的示例代码

**README_QUICK_REFERENCE.md**:
- 快速参考卡
- 常用命令速查
- 问题解决方案快速查找

#### 🐛 修复的问题

- 修复了复杂表格转换时的列偏移问题
- 修复了合并单元格导致的列数计算错误
- 修复了零宽度空列干扰表格对齐的问题
- 改进了错误消息的可读性

### 改进内容

#### 用户体验
- 更清晰的命令行帮助信息
- 更详细的转换过程日志
- 更好的错误提示和建议
- 支持临时文件自动清理

#### 性能优化
- HTML 预处理使用正则表达式优化
- 减少不必要的文件 I/O 操作
- 批量转换时的进度显示

#### 代码质量
- 添加了完整的函数文档字符串
- 改进了代码结构和可读性
- 增强了错误处理机制
- 添加了类型提示（部分）

### 文件结构更新

```
pypandoc-converter/
├── SKILL.md                              # 更新：增加表格处理内容
├── README_QUICK_REFERENCE.md             # 新增：快速参考卡
├── README_TEST.md                        # 保留：测试文档
├── CHANGELOG.md                          # 新增：更新日志
├── scripts/
│   ├── convert_to_markdown.py           # 更新：增强功能
│   └── preprocess_html.py                # 新增：HTML 预处理工具
├── references/
│   ├── table_conversion_guide.md         # 新增：表格转换指南
│   ├── installation_guide.md            # 保留：安装指南
│   └── supported_formats.md             # 保留：支持格式列表
├── examples/
│   └── table_conversion_example.py      # 新增：使用示例
└── assets/                               # 保留（空目录）
```

### 向后兼容性

- 所有原有功能保持不变
- 新增功能均为可选，不影响现有用法
- 原有 API 继续支持

### 迁移指南

对于现有用户：

1. **基本转换**：无需更改，继续使用原有命令
2. **遇到表格问题**：使用新的 `--two-step` 选项
3. **需要更多控制**：使用新的 `--step1` / `--step2` 分步选项

### 已知限制

1. 非常复杂的合并单元格可能仍需手动修复 HTML
2. 某些特殊格式的表格可能需要调整预处理逻辑
3. PDF 转换质量取决于 PDF 的结构化程度

### 下一步计划

- [ ] 支持更多 Markdown 方言
- [ ] 添加表格格式验证器
- [ ] 支持自定义预处理规则
- [ ] 添加转换报告生成功能
- [ ] 支持批量文件的并发转换

---

## [1.0.0] - 初始版本

### 基础功能

- 基本的文档格式转换
- 支持单文件和批量转换
- 命令行接口
- Python API
- 基本的文档

---

**注意**：版本 2.0.0 是一个重大更新，专门解决了用户反馈的复杂表格转换问题。建议所有用户升级以获得更好的表格转换体验。
